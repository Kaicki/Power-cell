<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Powercine - Login/Registro</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { margin:0; font-family: Arial; background:#111; color:#fff; display:flex; justify-content:center; align-items:center; height:100vh; }
  .container { display:flex; gap:50px; background:#222; padding:40px; border-radius:12px; }
  .box { width:250px; text-align:center; background:#333; padding:20px; border-radius:10px; }
  .box h2 { margin-bottom:15px; }
  input { width:90%; padding:10px; margin:8px 0; border-radius:5px; border:none; }
  button { width:95%; padding:10px; margin-top:10px; border:none; border-radius:5px; background:#28a745; color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; }
  button:hover { background:#1e7e34; }
  #msgLogin, #msgRegistro { color:#ff6666; min-height:20px; margin-top:10px; }
  #catalogo { display:none; text-align:center; margin-top:20px; }
  .filme { display:inline-block; margin:10px; cursor:pointer; transition: transform 0.3s; }
  .filme img { width:150px; border-radius:8px; }
  .filme:hover { transform:scale(1.05); }
</style>
</head>
<body>

<div class="container">

  <!-- LOGIN -->
  <div class="box">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginSenha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
    <div id="msgLogin"></div>
  </div>

  <!-- REGISTRO -->
  <div class="box">
    <h2>Registrar</h2>
    <input type="email" id="regEmail" placeholder="Email">
    <input type="password" id="regSenha" placeholder="Senha (mín 6 caracteres)">
    <button onclick="registrar()">Registrar</button>
    <div id="msgRegistro"></div>
  </div>

</div>

<!-- CATÁLOGO -->
<div id="catalogo">
  <h2>Catálogo de Filmes</h2>
  <div id="filmes"></div>
  <button onclick="logout()">Sair</button>
</div>

<script>
  // Supabase
  const supabaseUrl = 'https://zcvhgofvygxetbuicvab.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpjdmhnb2Z2eWd4ZXRidWljdmFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwODk1MTQsImV4cCI6MjA3NTY2NTUxNH0.PWkAEGMfR87XU12Tj6MoHR2v6LehnXuT5RvcHvMjhoo';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // Registrar
  async function registrar(){
    const email = document.getElementById('regEmail').value;
    const senha = document.getElementById('regSenha').value;
    if(!email || senha.length<6){ 
      document.getElementById('msgRegistro').innerText='Preencha email e senha válida'; return; 
    }
    const { data, error } = await supabase.auth.signUp({ email, password: senha });
    if(error && !error.message.includes("User already registered")) document.getElementById('msgRegistro').innerText = error.message;
    else{
      // login automático
      const { data: loginData, error: loginError } = await supabase.auth.signInWithPassword({ email, password: senha });
      if(loginError){ document.getElementById('msgRegistro').innerText=loginError.message; return; }
      carregarCatalogo();
    }
  }

  // Login
  async function login(){
    const email = document.getElementById('loginEmail').value;
    const senha = document.getElementById('loginSenha').value;
    if(!email || !senha){ document.getElementById('msgLogin').innerText='Preencha email e senha'; return; }
    const { data, error } = await supabase.auth.signInWithPassword({ email, password: senha });
    if(error) document.getElementById('msgLogin').innerText = error.message;
    else carregarCatalogo();
  }

  // Logout
  async function logout(){
    await supabase.auth.signOut();
    document.getElementById('catalogo').style.display='none';
    document.querySelector('.container').style.display='flex';
    document.getElementById('msgLogin').innerText='';
    document.getElementById('msgRegistro').innerText='';
  }

  // Carregar catálogo
  async function carregarCatalogo(){
    document.querySelector('.container').style.display='none';
    document.getElementById('catalogo').style.display='block';
    const { data: filmes, error } = await supabase.from('filmes').select('*');
    const container = document.getElementById('filmes');
    container.innerHTML='';
    if(error){ container.innerText='Erro ao carregar filmes'; console.error(error); return; }
    filmes.forEach(f=>{
      const div = document.createElement('div');
      div.className='filme';
      div.innerHTML=`<img src="${f.capa}" alt="${f.titulo}"><br>${f.titulo}`;
      container.appendChild(div);
    });
  }

  // Persistir sessão
  supabase.auth.getSession().then(({data})=>{
    if(data.session) carregarCatalogo();
  });
</script>

</body>
</html>
